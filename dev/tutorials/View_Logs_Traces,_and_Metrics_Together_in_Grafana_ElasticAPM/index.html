<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>View Metrics/Traces/Logs in Grafana/ElasticAPM · OpenTelemetry.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-YWC6SQHSVM"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-YWC6SQHSVM', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="OpenTelemetry.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OpenTelemetry.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../View_Metrics_in_Prometheus/">View Metrics in Prometheus</a></li><li><a class="tocitem" href="../View_Metrics_in_Prometheus_through_Open_Telemetry_Collector/">View Metrics in Prometheus through Open Telemetry Collector</a></li><li><a class="tocitem" href="../View_Traces_in_Jaeger/">View Traces in Jaeger</a></li><li><a class="tocitem" href="../Send_Logs_to_Loki_via_OpenTelemetry_Collector/">Send Logs to Loki via OpenTelemetry Collector</a></li><li><a class="tocitem" href="../A_Typical_Example_with_HTTP.jl/">A Typical Example with HTTP.jl</a></li></ul></li><li><a class="tocitem" href="../../FAQ/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>View Metrics/Traces/Logs in Grafana/ElasticAPM</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>View Metrics/Traces/Logs in Grafana/ElasticAPM</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/oolong-dev/OpenTelemetry.jl/blob/master/docs/src/tutorials/View_Logs_Traces,_and_Metrics_Together_in_Grafana_ElasticAPM/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="View-Metrics/Traces/Logs-in-Grafana/ElasticAPM"><a class="docs-heading-anchor" href="#View-Metrics/Traces/Logs-in-Grafana/ElasticAPM">View Metrics/Traces/Logs in Grafana/ElasticAPM</a><a id="View-Metrics/Traces/Logs-in-Grafana/ElasticAPM-1"></a><a class="docs-heading-anchor-permalink" href="#View-Metrics/Traces/Logs-in-Grafana/ElasticAPM" title="Permalink"></a></h1><p>In previous tutorials, we&#39;ve learned how to record and visualize metrics. This tutorial will continue on exploring traces and logs. In the end, we&#39;ll see how these three pillars are fused together to improve the observability of your system.</p><h2 id="Traces"><a class="docs-heading-anchor" href="#Traces">Traces</a><a id="Traces-1"></a><a class="docs-heading-anchor-permalink" href="#Traces" title="Permalink"></a></h2><p>In short, traces are used to record the time spans of each element operations we are interested in during a function call. In <code>OpenTelemetry.jl</code>, we use <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.with_span"><code>with_span</code></a> to initiate a new span. Each span can be nested in another span. And the outest one is called the root span, which naturally forms one trace.</p><pre><code class="language-julia hljs">using OpenTelemetry

with_span(&quot;Hello&quot;) do
    with_span(&quot;World&quot;) do
        println(&quot;Hello world from OpenTelemetry.jl!&quot;)
    end
end</code></pre><p>For example, here we created two spans, the root span is named <code>&quot;Hello&quot;</code>. By default, the spans are print to the console in detail. To visualize them, we can follow what we did before to set up the OpenTelemetry Collector first.</p><pre><code class="language-bash hljs">cd docs/src/tutorials/View_Logs_Traces,_and_Metrics_Together_in_Grafana_ElasticAPM
docker-compose -f docker-compose-jaeger.yml up</code></pre><p>Then how to send the spans to OpenTelemetry Collector?</p><p>The idea is very similar to the logging system in Julia. At the end of each span, it will be sent to the <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.global_tracer_provider-Tuple{Any}"><code>global_tracer_provider</code></a> implicitly. We can configure it to forward spans to the OpenTelemetry Collector.</p><pre><code class="language-julia hljs">global_tracer_provider!(
    TracerProvider(
        span_processor=SimpleSpanProcessor(
            OtlpProtoGrpcTraceExporter()
        )
    )
)</code></pre><p>Now create the spans again:</p><pre><code class="language-julia hljs">with_span(&quot;Hello&quot;) do
    with_span(&quot;World&quot;) do
        println(&quot;Hello world from OpenTelemetry.jl!&quot;)
    end
end</code></pre><p>Then open the Jaeger UI at <a href="http://localhost:16686">http://localhost:16686</a>. You can find the trace we just created by filtering the <code>Operations</code> with span name.</p><h3 id="View-Traces-in-Tempo"><a class="docs-heading-anchor" href="#View-Traces-in-Tempo">View Traces in Tempo</a><a id="View-Traces-in-Tempo-1"></a><a class="docs-heading-anchor-permalink" href="#View-Traces-in-Tempo" title="Permalink"></a></h3><p>Should be similar to Jaeger, but I haven&#39;t test it yet.</p><h2 id="Logs"><a class="docs-heading-anchor" href="#Logs">Logs</a><a id="Logs-1"></a><a class="docs-heading-anchor-permalink" href="#Logs" title="Permalink"></a></h2><h3 id="View-Logs-in-Loki"><a class="docs-heading-anchor" href="#View-Logs-in-Loki">View Logs in Loki</a><a id="View-Logs-in-Loki-1"></a><a class="docs-heading-anchor-permalink" href="#View-Logs-in-Loki" title="Permalink"></a></h3><p>Wait https://github.com/grafana/loki/issues/5346</p><h2 id="Putting-Them-All-Together"><a class="docs-heading-anchor" href="#Putting-Them-All-Together">Putting Them All Together</a><a id="Putting-Them-All-Together-1"></a><a class="docs-heading-anchor-permalink" href="#Putting-Them-All-Together" title="Permalink"></a></h2><h3 id="Grafana"><a class="docs-heading-anchor" href="#Grafana">Grafana</a><a id="Grafana-1"></a><a class="docs-heading-anchor-permalink" href="#Grafana" title="Permalink"></a></h3><p>TODO, wait Logs are supported in Loki</p><h3 id="Elastic-APM"><a class="docs-heading-anchor" href="#Elastic-APM">Elastic APM</a><a id="Elastic-APM-1"></a><a class="docs-heading-anchor-permalink" href="#Elastic-APM" title="Permalink"></a></h3><p>Elastic APM is very powerful to help you gain insights across logs, traces and metrics. However, setting up a workable Elastic APM environment may be over complicated for first time users. What make it more difficulty is the security related configurations enabled by default after ElasticSearch 8. Since you decide to give it a try, I can safely assume you are familiar with ElasticSearch, Kibana and a little bit about APM-Server. From the architecture level, Elastic APM is similar to what we&#39;ve seen before. If you&#39;ve already got a functional ElasticSearch and Kibana, then follow <a href="https://www.elastic.co/guide/en/apm/guide/8.0/apm-quick-start.html">the official documentation</a> to set up the Fleet and add the APM integration. In the 4th step, Install APM Agents, you&#39;ll find that there&#39;s no Julia related APM agent yet! And that&#39;s why we use <code>OpenTelemetry.jl</code>! If you&#39;re familiar with one of the programming languages listed there, give it a try and explore the exported data in Kibana. Then come back and see how to do it with <code>OpenTelemetry.jl</code>.</p><p>If you do not have ElasticSearch and Kibana installed yet, you can follow the following instructions to set them up quickly. Most of the configs are adapted from <a href="https://github.com/elastic/apm-server/blob/main/docker-compose.yml">apm-server/docker-compose.yml</a>. Note that they are for test only, do not use them in production environments. (DO NOT SAY I DIDN&#39;T WARN YOU!)</p><pre><code class="language-bash hljs">cd docs/src/tutorials/View_Logs_Traces,_and_Metrics_Together_in_Grafana_Logstash_SigNoz
docker-compose up</code></pre><p>Then login to the kibana at <a href="http://localhost:5601">localhost:5601</a> with the username <code>admin</code> and password <code>changeme</code> if you didn&#39;t change them. After that, follow the step 3 in <a href="https://www.elastic.co/guide/en/apm/guide/8.0/apm-quick-start.html">the official documentation</a> to add a APM integration. You may want to change the host and url to <code>0.0.0.0:8200</code> and <code>http://0.0.0.0:8200</code>.</p><p>The only left one is to setup the OpenTelemetry Collector. In the <code>docker-compose.yml</code> file, it&#39;s already setup. You can read more details on the configurations at <a href="https://www.elastic.co/guide/en/apm/guide/8.0/open-telemetry.html">OpenTelemetry Integration in Elastic APM</a>.</p><p>The rest is the same as we did before. Open the Julia REPL and try to add some traces/logs/metrics to the OpenTelemetry Collector. Then explore the collected data by following step 5 in <a href="https://www.elastic.co/guide/en/apm/guide/8.0/apm-quick-start.html">the official doc on Elastic APM</a>.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 24 April 2024 12:43">Wednesday 24 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
