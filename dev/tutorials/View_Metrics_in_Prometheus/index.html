<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>View Metrics in Prometheus · OpenTelemetry.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-YWC6SQHSVM"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-YWC6SQHSVM', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="OpenTelemetry.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OpenTelemetry.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li class="is-active"><a class="tocitem" href>View Metrics in Prometheus</a></li><li><a class="tocitem" href="../View_Metrics_in_Prometheus_through_Open_Telemetry_Collector/">View Metrics in Prometheus through Open Telemetry Collector</a></li><li><a class="tocitem" href="../View_Logs_Traces,_and_Metrics_Together_in_Grafana_ElasticAPM/">View Metrics/Traces/Logs in Grafana/ElasticAPM</a></li></ul></li><li><a class="tocitem" href="../../tips/">Tips for Developers</a></li><li><a class="tocitem" href="../../FAQ/">FAQ</a></li><li><span class="tocitem">Design</span><ul><li><a class="tocitem" href="../../OpenTelemetryAPI/">OpenTelemetryAPI</a></li><li><a class="tocitem" href="../../OpenTelemetrySDK/">OpenTelemetrySDK</a></li><li><a class="tocitem" href="../../OpenTelemetryExporterOtlpProtoGrpc/">OpenTelemetryExporterOtlpProtoGrpc</a></li><li><a class="tocitem" href="../../OpenTelemetryExporterPrometheus/">OpenTelemetryExporterPrometheus</a></li><li><a class="tocitem" href="../../OpenTelemetryProto/">OpenTelemetryProto</a></li><li><a class="tocitem" href="../../OpenTelemetryInstrumentationBase/">OpenTelemetryInstrumentationBase</a></li><li><a class="tocitem" href="../../OpenTelemetryInstrumentationDownloads/">OpenTelemetryInstrumentationDownloads</a></li><li><a class="tocitem" href="../../OpenTelemetryInstrumentationDistributed/">OpenTelemetryInstrumentationDistributed</a></li><li><a class="tocitem" href="../../OpenTelemetryInstrumentationHTTP/">OpenTelemetryInstrumentationHTTP</a></li><li><a class="tocitem" href="../../OpenTelemetryInstrumentationGenie/">OpenTelemetryInstrumentationGenie</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>View Metrics in Prometheus</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>View Metrics in Prometheus</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/oolong-dev/OpenTelemetry.jl/blob/master/docs/src/tutorials/View_Metrics_in_Prometheus/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="View-Metrics-in-Prometheus"><a class="docs-heading-anchor" href="#View-Metrics-in-Prometheus">View Metrics in Prometheus</a><a id="View-Metrics-in-Prometheus-1"></a><a class="docs-heading-anchor-permalink" href="#View-Metrics-in-Prometheus" title="Permalink"></a></h1><p>Before learning how to view metrics in <a href="https://prometheus.io/">Prometheus</a>, let&#39;s take a close look at the example code in the <a href="https://github.com/oolong-dev/OpenTelemetry.jl#metrics">Get Started#Metrics</a> section.</p><pre><code class="language-julia hljs">using OpenTelemetry</code></pre><p><code>OpenTelemetry.jl</code> is a meta package of several sub-packages. In practice, we&#39;d import proper sub-packages based on the need. Here we simply import this meta package for tutorial purpose.</p><pre><code class="language-julia hljs">m = Meter(&quot;demo_metrics&quot;);</code></pre><p>First, a <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Meter"><code>Meter</code></a> is defined with the name <code>&quot;demo_metrics&quot;</code>. A <code>Meter</code> is used to group several instruments together to measure some similar aspects of a system. In an application, you may create many different meters as you wish.</p><pre><code class="language-julia hljs">c = Counter{Int}(&quot;fruit_counter&quot;, m)</code></pre><p>Then let&#39;s create an instrument of type <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Counter"><code>Counter</code></a> to count the number of fruits. A <code>Counter</code>, as the name indicates, is used to count the number of something. Each instrument must be associated with a <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Meter"><code>Meter</code></a> (the <code>m</code> here). Note that the parameter type <code>Int</code> indicates that we&#39;ll use an <code>Int</code> to represent the value. Although we can many other <code>Number</code> types in Julia, <code>Int</code> and <code>Float64</code> are the common ones supported by most Application Performance Monitoring (APM) systems.</p><pre><code class="language-julia hljs">c(; name = &quot;apple&quot;, color = &quot;red&quot;)</code></pre><p>Each counter is a functional object. Now, let&#39;s say we&#39;ve seen a red apple. We can call it directly without positional arguments, which implicitly means we&#39;ve seen exactly <strong>ONE</strong> fruit. The two extra keyword arguments, <code>name</code> and <code>color</code>, define two dimensions of our fruit counter <code>c</code>. In theory, we can define a dedicated counter named <code>&quot;red_apple_counter&quot;</code>. But adding extra dimensions will help us perform some aggregations on the resulted metrics. We&#39;ll discuss the advantage in detail later.</p><pre><code class="language-julia hljs">c(2; name = &quot;lemon&quot;, color = &quot;yellow&quot;)
c(1; name = &quot;lemon&quot;, color = &quot;yellow&quot;)
c(2; name = &quot;apple&quot;, color = &quot;green&quot;)
c(5; name = &quot;apple&quot;, color = &quot;red&quot;)
c(4; name = &quot;lemon&quot;, color = &quot;yellow&quot;)</code></pre><p>After adding more fruits. Now a question naturally arises, &quot;How many fruits have we seen until now?&quot; To answer this question, we need to create a <a href="../../OpenTelemetrySDK/#OpenTelemetrySDK.MetricReader"><code>MetricReader</code></a>.</p><pre><code class="language-julia hljs">r = MetricReader();</code></pre><p>As you may noticed, a bunch of information is printed in the console. What we&#39;re most interested in is the <code>value</code> field of each entry in the <code>unique_points</code>. Could you confirm they are exactly the same with the fruits we&#39;ve seen?</p><p>Now let&#39;s add some more fruits.</p><pre><code class="language-julia hljs">c(10; name = &quot;lychee&quot;, color = &quot;red&quot;)
c(8; name = &quot;longan&quot;, color = &quot;yellow&quot;)
c(3; name = &quot;apple&quot;, color = &quot;red&quot;)</code></pre><p>To view all the fruits we&#39;ve seen now, we can call the reader defined before, which is parameterless functional object.</p><pre><code class="language-julia hljs">r()</code></pre><p>Although the information printed in the console is exhaustive, there&#39;re some better tools to visualize the metrics intuitively. And this introduces the topic of the tutorial, to view metrics in Prometheus.</p><p>To allow Prometheus communicate with metrics defined in <code>OpenTelemetry.jl</code>, we need to create another <a href="../../OpenTelemetrySDK/#OpenTelemetrySDK.MetricReader"><code>MetricReader</code></a>:</p><pre><code class="language-julia hljs">prometheus_reader = MetricReader(PrometheusExporter(; host = &quot;0.0.0.0&quot;, port = 9966));</code></pre><p>In the above code, we initialized a <a href="../../OpenTelemetryExporterPrometheus/#OpenTelemetryExporterPrometheus.PrometheusExporter"><code>PrometheusExporter</code></a> which listens to the port <code>9966</code> in the host environment. Now we just need to setup the Prometheus client. <a href="https://prometheus.io/docs/introduction/first_steps/#downloading-prometheus">The official Prometheus website</a> documents it well on how to install and configure the Prometheus client. Personally, I&#39;d usually use docker for this kind of quick experiments. Make sure you have <a href="https://docs.docker.com/engine/install/">docker</a> and <a href="https://docs.docker.com/compose/install/">docker-compose</a> properly installed on your system. We&#39;ll use them throughout all the tutorials. Keep your existing Julia REPL open and we&#39;ll come back to it soon. Now open another terminal, follow the following commands to clone this repo and setup the Prometheus.</p><pre><code class="language-bash hljs">git clone git@github.com:oolong-dev/OpenTelemetry.jl.git
cd docs/src/tutorials/View_Metrics_in_Prometheus
docker-compose up -d</code></pre><p>Now open your browser and head to <code>127.0.0.1:9090</code>. You&#39;ll see the Prometheus portal.</p><p><img src="prometheus_client.png" alt/></p><p>Then click the icon near the <strong>Execute</strong> button to select the <code>fruit_counter</code>, and finally click the <strong>Execute</strong> button to execute the query. You&#39;ll see the metrics in the <strong>Table</strong> tab. Now switch to the <strong>Graph</strong> tab, you can see historical values of the fruit counter in each dimension. Come back to the Julia REPL. Try to add more fruits and see how the graph in the Prometheus portal changes.</p><p>In <a href="tutorials/View_Metrics_in_Prometheus_through_OpenTelemetry_Collector/">the next tutorial</a>, we&#39;ll learn more about <a href="https://opentelemetry.io/">OpenTelemetry</a> and advanced metrics related usages.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../View_Metrics_in_Prometheus_through_Open_Telemetry_Collector/">View Metrics in Prometheus through Open Telemetry Collector »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.13 on <span class="colophon-date" title="Wednesday 2 March 2022 16:20">Wednesday 2 March 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
