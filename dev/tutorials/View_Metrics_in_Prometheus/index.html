<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>View Metrics in Prometheus · OpenTelemetry.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-YWC6SQHSVM"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-YWC6SQHSVM', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="OpenTelemetry.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OpenTelemetry.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li class="is-active"><a class="tocitem" href>View Metrics in Prometheus</a><ul class="internal"><li><a class="tocitem" href="#Export-Metrics-to-Prometheus"><span>Export Metrics to Prometheus</span></a></li><li><a class="tocitem" href="#Export-Metrics-to-Prometheus-through-Pushgateway"><span>Export Metrics to Prometheus through Pushgateway</span></a></li></ul></li><li><a class="tocitem" href="../View_Metrics_in_Prometheus_through_Open_Telemetry_Collector/">View Metrics in Prometheus through Open Telemetry Collector</a></li><li><a class="tocitem" href="../View_Traces_in_Jaeger/">View Traces in Jaeger</a></li><li><a class="tocitem" href="../Send_Logs_to_Loki_via_OpenTelemetry_Collector/">Send Logs to Loki via OpenTelemetry Collector</a></li><li><a class="tocitem" href="../A_Typical_Example_with_HTTP.jl/">A Typical Example with HTTP.jl</a></li></ul></li><li><a class="tocitem" href="../../FAQ/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>View Metrics in Prometheus</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>View Metrics in Prometheus</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/oolong-dev/OpenTelemetry.jl/blob/master/docs/src/tutorials/View_Metrics_in_Prometheus/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="View-Metrics-in-Prometheus"><a class="docs-heading-anchor" href="#View-Metrics-in-Prometheus">View Metrics in Prometheus</a><a id="View-Metrics-in-Prometheus-1"></a><a class="docs-heading-anchor-permalink" href="#View-Metrics-in-Prometheus" title="Permalink"></a></h1><p>Before learning how to view metrics in <a href="https://prometheus.io/">Prometheus</a>, let&#39;s take a close look at the example code in the <a href="https://github.com/oolong-dev/OpenTelemetry.jl#metrics">Get Started#Metrics</a> section.</p><pre><code class="language-julia hljs">using OpenTelemetry</code></pre><p><code>OpenTelemetry.jl</code> is a meta package of several sub-packages. In practice, we&#39;d import proper sub-packages based on the need. Here we simply import this meta package for tutorial purpose.</p><pre><code class="language-julia hljs">using Term</code></pre><p>It is also recommended to import the <a href="https://github.com/FedeClaudi/Term.jl"><code>Term.jl</code></a> package for better rendering in REPL.</p><pre><code class="language-julia hljs">global_meter_provider(MeterProvider());</code></pre><p>The default global meter provider is a <code>DummyMeterProvider()</code>, which is just a placeholder and will do nothing. Try to remove this line and you won&#39;t see any metrics info printed in your console anymore.</p><p>Here we set the global meter provider to <code>MeterProvider()</code>. More configurations about <code>MeterProvider</code> will be explained later.</p><pre><code class="language-julia hljs">m = Meter(&quot;demo_metrics&quot;);</code></pre><p>Now, a <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Meter"><code>Meter</code></a> is defined with the name <code>&quot;demo_metrics&quot;</code>. A <code>Meter</code> is used to group several instruments together to measure some similar aspects of a system. In an application, you may create many different meters as you wish.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Here the meter is implicitly associated with the <code>global_meter_provider</code>. Users are recommended to use <code>Meter(&quot;demo_metrics&quot;; provider=MeterProvider())</code> explicitly in practice.</p></div></div><pre><code class="language-julia hljs">c = Counter{Int}(&quot;fruit_counter&quot;, m)</code></pre><p>Then let&#39;s create an instrument of type <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Counter"><code>Counter</code></a> to count the number of fruits. A <code>Counter</code>, as the name indicates, is used to count the number of something. Each instrument must be associated with a <a href="../../OpenTelemetryAPI/#OpenTelemetryAPI.Meter"><code>Meter</code></a> (the <code>m</code> here). Note that the parameter type <code>Int</code> indicates that we&#39;ll use an <code>Int</code> to represent the value. Although we have many other <code>Number</code> types in Julia, <code>Int</code> and <code>Float64</code> are the common ones supported by most Application Performance Monitoring (APM) systems.</p><pre><code class="language-julia hljs">c(; name = &quot;apple&quot;, color = &quot;red&quot;)</code></pre><p>Each counter is a functional object. Now, let&#39;s say we&#39;ve seen a red apple. We can call it directly without positional arguments, which implicitly means we&#39;ve seen exactly <strong>ONE</strong> fruit. The two extra keyword arguments, <code>name</code> and <code>color</code>, define two dimensions of our fruit counter <code>c</code>. In theory, we can define a dedicated counter named <code>&quot;red_apple_counter&quot;</code>. But adding extra dimensions will help us perform some aggregations on the resulted metrics. We&#39;ll discuss the advantage in detail later.</p><pre><code class="language-julia hljs">c(2; name = &quot;lemon&quot;, color = &quot;yellow&quot;)
c(1; name = &quot;lemon&quot;, color = &quot;yellow&quot;)
c(2; name = &quot;apple&quot;, color = &quot;green&quot;)
c(5; name = &quot;apple&quot;, color = &quot;red&quot;)
c(4; name = &quot;lemon&quot;, color = &quot;yellow&quot;)</code></pre><p>After adding more fruits. Now a question naturally arises, &quot;How many fruits have we seen until now?&quot; To answer this question, we need to create a <a href="../../OpenTelemetrySDK/#OpenTelemetrySDK.MetricReader"><code>MetricReader</code></a>.</p><pre><code class="language-julia hljs">r = MetricReader();</code></pre><p>Here we omit two positional arguments. By default, the <code>MetricReader</code> will read metrics associated with the <code>global_meter_provider()</code> and export them to console.</p><p>As you may noticed, a bunch of information is printed in the console. What we&#39;re most interested in is the <code>value</code> field of each entry under the <code>points</code> field. Could you manually confirm they are exactly the same with the fruits we&#39;ve seen?</p><p>Now let&#39;s add some more fruits.</p><pre><code class="language-julia hljs">c(10; name = &quot;lychee&quot;, color = &quot;red&quot;)
c(8; name = &quot;longan&quot;, color = &quot;yellow&quot;)
c(3; name = &quot;apple&quot;, color = &quot;red&quot;)</code></pre><p>To view all the fruits we&#39;ve seen now, we can call the reader defined before, which is parameterless functional object.</p><pre><code class="language-julia hljs">r()</code></pre><h2 id="Export-Metrics-to-Prometheus"><a class="docs-heading-anchor" href="#Export-Metrics-to-Prometheus">Export Metrics to Prometheus</a><a id="Export-Metrics-to-Prometheus-1"></a><a class="docs-heading-anchor-permalink" href="#Export-Metrics-to-Prometheus" title="Permalink"></a></h2><p>Although the information printed in the console is exhaustive, there&#39;re some better tools to help visualize the metrics intuitively. And this introduces the topic of the tutorial, to view metrics in Prometheus.</p><p>Generally, there are two approaches to export metrics into Prometheus, the <code>push</code> or <code>pull</code> based approach. The <code>push</code> based approach means every time we call <code>r()</code>, the metrics are send to a remote Prometheus service. While the <code>pull</code> based approach means our <code>MetricReader</code> sets up a service and wait for Prometheus to fetch metrics.</p><p>In <code>OpenTelemetry.jl</code>, only the <em>pull-based</em> approach is implemented for now.</p><pre><code class="language-julia hljs">prometheus_reader = MetricReader(PrometheusExporter());</code></pre><p>In the above code, we initialized a <a href="../../OpenTelemetryExporterPrometheus/#OpenTelemetryExporterPrometheus.PrometheusExporter"><code>PrometheusExporter</code></a> which listens to the endpoint of <code>http://localhost:9496/metrics</code>. Now open the link in your browser. You&#39;ll see metrics displayed as plain texts.</p><p>That&#39;s it!</p><p>You can further configure the endpoint either explicitly with keyword arguments or implicitly through environment variables (TODO: insert a link to supported environment variables page).</p><p>For example, to allow external prometheus services to fetch metrics, we can set the host to <code>0.0.0.0</code>.</p><pre><code class="language-julia hljs">close(prometheus_reader)  # close it first, or you can choose another port to avoid conflict.
prometheus_reader = MetricReader(PrometheusExporter(host=&quot;0.0.0.0&quot;));</code></pre><p>The last step is to setup Prometheus and configure it to read the metrics we provided above. <a href="https://prometheus.io/docs/introduction/first_steps/#downloading-prometheus">The official Prometheus website</a> documents it well on how to install and configure the Prometheus client. Personally, I&#39;d usually use docker for this kind of quick experiments. Make sure you have <a href="https://docs.docker.com/engine/install/">docker</a> and <a href="https://docs.docker.com/compose/install/">docker-compose</a> properly installed on your system. We&#39;ll use them throughout all the tutorials. Keep your existing Julia REPL open and we&#39;ll come back to it soon. Now open another terminal, follow the commands below to clone this repo and setup the Prometheus.</p><pre><code class="language-bash hljs">git clone git@github.com:oolong-dev/OpenTelemetry.jl.git
cd docs/src/tutorials/View_Metrics_in_Prometheus
docker compose up</code></pre><p>Now open your browser and head to <a href="http://localhost:9090">http://localhost:9090</a>. You&#39;ll see the following Prometheus portal.</p><p><img src="prometheus_client.png" alt/></p><p>Then click the icon near the <strong>Execute</strong> button to select the <code>fruit_counter</code>, and finally click the <strong>Execute</strong> button to execute the query. You&#39;ll see the metrics in the <strong>Table</strong> tab. Now switch to the <strong>Graph</strong> tab, you can see historical values of the fruit counter in each dimension. Come back to the Julia REPL. Try to add more fruits and see how the graph in the Prometheus portal changes.</p><h2 id="Export-Metrics-to-Prometheus-through-Pushgateway"><a class="docs-heading-anchor" href="#Export-Metrics-to-Prometheus-through-Pushgateway">Export Metrics to Prometheus through Pushgateway</a><a id="Export-Metrics-to-Prometheus-through-Pushgateway-1"></a><a class="docs-heading-anchor-permalink" href="#Export-Metrics-to-Prometheus-through-Pushgateway" title="Permalink"></a></h2><p>In some cases, you may prefer the <a href="https://github.com/prometheus/pushgateway">Pushgateway</a> approach to export metrics. You can create a reader with <code>PrometheusPushgatewayExporter</code>.</p><pre><code class="language-julia hljs">prometheus_reader = MetricReader(PrometheusPushgatewayExporter(;resource_to_telemetry_conversion=true));</code></pre><p>Then each time we call <code>prometheus_reader()</code>, it will send the latest metrics to the default push gateway endpoint.</p><p>In <a href="tutorials/View_Metrics_in_Prometheus_through_OpenTelemetry_Collector/">the next tutorial</a>, we&#39;ll learn more about <a href="https://opentelemetry.io/">OpenTelemetry</a> and advanced metrics related usages.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../View_Metrics_in_Prometheus_through_Open_Telemetry_Collector/">View Metrics in Prometheus through Open Telemetry Collector »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 19 April 2024 09:27">Friday 19 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
